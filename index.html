<!DOCTYPE html>
<html>
  <head>
    <meta charset="utf-8" />
    <meta
      name="viewport"
      content="width=device-width, initial-scale=1.0, user-scalable=no"
    />
    <title>Firebase Cloud Messaging Example</title>

    <link rel="icon" href="/groupster.png" type="image/png" />

    <link rel="apple-touch-icon" href="icons/apple-icon-180.png" />

    <meta name="apple-mobile-web-app-capable" content="yes" />

    <link
      rel="apple-touch-startup-image"
      href="icons/apple-splash-2048-2732.jpg"
      media="(device-width: 1024px) 
and (device-height: 1366px) and (-webkit-device-pixel-ratio: 2) and (orientation: portrait)"
    />
    <link
      rel="apple-touch-startup-image"
      href="icons/apple-splash-2732-2048.jpg"
      media="(device-width: 1024px) 
and (device-height: 1366px) and (-webkit-device-pixel-ratio: 2) and (orientation: landscape)"
    />
    <link
      rel="apple-touch-startup-image"
      href="icons/apple-splash-1668-2388.jpg"
      media="(device-width: 834px) and (device-height: 1194px) and (-webkit-device-pixel-ratio: 2) and (orientation: portrait)"
    />
    <link
      rel="apple-touch-startup-image"
      href="icons/apple-splash-2388-1668.jpg"
      media="(device-width: 834px) and (device-height: 1194px) and (-webkit-device-pixel-ratio: 2) and (orientation: landscape)"
    />
    <link
      rel="apple-touch-startup-image"
      href="icons/apple-splash-1536-2048.jpg"
      media="(device-width: 768px) and (device-height: 1024px) and (-webkit-device-pixel-ratio: 2) and (orientation: portrait)"
    />
    <link
      rel="apple-touch-startup-image"
      href="icons/apple-splash-2048-1536.jpg"
      media="(device-width: 768px) and (device-height: 1024px) and (-webkit-device-pixel-ratio: 2) and (orientation: landscape)"
    />
    <link
      rel="apple-touch-startup-image"
      href="icons/apple-splash-1668-2224.jpg"
      media="(device-width: 834px) and (device-height: 1112px) and (-webkit-device-pixel-ratio: 2) and (orientation: portrait)"
    />
    <link
      rel="apple-touch-startup-image"
      href="icons/apple-splash-2224-1668.jpg"
      media="(device-width: 834px) and (device-height: 1112px) and (-webkit-device-pixel-ratio: 2) and (orientation: landscape)"
    />
    <link
      rel="apple-touch-startup-image"
      href="icons/apple-splash-1620-2160.jpg"
      media="(device-width: 810px) and (device-height: 1080px) and (-webkit-device-pixel-ratio: 2) and (orientation: portrait)"
    />
    <link
      rel="apple-touch-startup-image"
      href="icons/apple-splash-2160-1620.jpg"
      media="(device-width: 810px) and (device-height: 1080px) and (-webkit-device-pixel-ratio: 2) and (orientation: landscape)"
    />
    <link
      rel="apple-touch-startup-image"
      href="icons/apple-splash-1284-2778.jpg"
      media="(device-width: 428px) and (device-height: 926px) and (-webkit-device-pixel-ratio: 3) and (orientation: portrait)"
    />
    <link
      rel="apple-touch-startup-image"
      href="icons/apple-splash-2778-1284.jpg"
      media="(device-width: 428px) and (device-height: 926px) and (-webkit-device-pixel-ratio: 3) and (orientation: landscape)"
    />
    <link
      rel="apple-touch-startup-image"
      href="icons/apple-splash-1170-2532.jpg"
      media="(device-width: 390px) and (device-height: 844px) and (-webkit-device-pixel-ratio: 3) and (orientation: portrait)"
    />
    <link
      rel="apple-touch-startup-image"
      href="icons/apple-splash-2532-1170.jpg"
      media="(device-width: 390px) and (device-height: 844px) and (-webkit-device-pixel-ratio: 3) and (orientation: landscape)"
    />
    <link
      rel="apple-touch-startup-image"
      href="icons/apple-splash-1125-2436.jpg"
      media="(device-width: 375px) and (device-height: 812px) and (-webkit-device-pixel-ratio: 3) and (orientation: portrait)"
    />
    <link
      rel="apple-touch-startup-image"
      href="icons/apple-splash-2436-1125.jpg"
      media="(device-width: 375px) and (device-height: 812px) and (-webkit-device-pixel-ratio: 3) and (orientation: landscape)"
    />
    <link
      rel="apple-touch-startup-image"
      href="icons/apple-splash-1242-2688.jpg"
      media="(device-width: 414px) and (device-height: 896px) and (-webkit-device-pixel-ratio: 3) and (orientation: portrait)"
    />
    <link
      rel="apple-touch-startup-image"
      href="icons/apple-splash-2688-1242.jpg"
      media="(device-width: 414px) and (device-height: 896px) and (-webkit-device-pixel-ratio: 3) and (orientation: landscape)"
    />
    <link
      rel="apple-touch-startup-image"
      href="icons/apple-splash-828-1792.jpg"
      media="(device-width: 414px) and (device-height: 896px) and (-webkit-device-pixel-ratio: 2) and (orientation: portrait)"
    />
    <link
      rel="apple-touch-startup-image"
      href="icons/apple-splash-1792-828.jpg"
      media="(device-width: 414px) and (device-height: 896px) and (-webkit-device-pixel-ratio: 2) and (orientation: landscape)"
    />
    <link
      rel="apple-touch-startup-image"
      href="icons/apple-splash-1242-2208.jpg"
      media="(device-width: 414px) and (device-height: 736px) and (-webkit-device-pixel-ratio: 3) and (orientation: portrait)"
    />
    <link
      rel="apple-touch-startup-image"
      href="icons/apple-splash-2208-1242.jpg"
      media="(device-width: 414px) and (device-height: 736px) and (-webkit-device-pixel-ratio: 3) and (orientation: landscape)"
    />
    <link
      rel="apple-touch-startup-image"
      href="icons/apple-splash-750-1334.jpg"
      media="(device-width: 375px) and (device-height: 667px) and (-webkit-device-pixel-ratio: 2) and (orientation: portrait)"
    />
    <link
      rel="apple-touch-startup-image"
      href="icons/apple-splash-1334-750.jpg"
      media="(device-width: 375px) and (device-height: 667px) and (-webkit-device-pixel-ratio: 2) and (orientation: landscape)"
    />
    <link
      rel="apple-touch-startup-image"
      href="icons/apple-splash-640-1136.jpg"
      media="(device-width: 320px) and (device-height: 568px) and (-webkit-device-pixel-ratio: 2) and (orientation: portrait)"
    />
    <link
      rel="apple-touch-startup-image"
      href="icons/apple-splash-1136-640.jpg"
      media="(device-width: 320px) and (device-height: 568px) and (-webkit-device-pixel-ratio: 2) and (orientation: landscape)"
    />

    <!-- Material Design Theming -->
    <link
      rel="stylesheet"
      href="https://code.getmdl.io/1.1.3/material.orange-indigo.min.css"
    />
    <link
      rel="stylesheet"
      href="https://fonts.googleapis.com/icon?family=Material+Icons"
    />
    <script defer src="https://code.getmdl.io/1.1.3/material.min.js"></script>

    <link rel="stylesheet" href="main.css" />

    <link rel="manifest" href="/manifest.json" />
  </head>
  <body>
    <div class="demo-layout mdl-layout mdl-js-layout mdl-layout--fixed-header">
      <!-- Header section containing title -->
      <header
        class="
          mdl-layout__header
          mdl-color-text--white
          mdl-color--light-blue-700
        "
      >
        <div class="mdl-cell mdl-cell--12-col mdl-cell--12-col-tablet mdl-grid">
          <div
            class="
              mdl-layout__header-row
              mdl-cell
              mdl-cell--12-col
              mdl-cell--12-col-tablet
              mdl-cell--8-col-desktop
            "
          >
            <h3>Firebase Cloud Messaging</h3>
          </div>
        </div>
      </header>

      <main class="mdl-layout__content mdl-color--grey-100">
        <div class="mdl-cell mdl-cell--12-col mdl-cell--12-col-tablet mdl-grid">
          <!-- Container for the Table of content -->
          <div
            class="
              mdl-card
              mdl-shadow--2dp
              mdl-cell
              mdl-cell--12-col
              mdl-cell--12-col-tablet
              mdl-cell--12-col-desktop
            "
          >
            <div class="mdl-card__supporting-text mdl-color-text--grey-600">
              <!-- div to display the generated registration token -->
              <div id="token_div" style="display: none">
                <h4>Registration Token</h4>
                <p id="token" style="word-break: break-all"></p>
                <button
                  class="
                    mdl-button mdl-js-button
                    mdl-button--raised mdl-button--colored
                  "
                  onclick="deleteToken()"
                >
                  Delete Token
                </button>
              </div>
              <!-- div to display the UI to allow the request for permission to
               notify the user. This is shown if the app has not yet been
               granted permission to notify. -->
              <div id="permission_div" style="display: none">
                <h4>Needs Permission</h4>
                <p id="token"></p>
                <button
                  class="
                    mdl-button mdl-js-button
                    mdl-button--raised mdl-button--colored
                  "
                  onclick="requestPermission()"
                >
                  Request Permission
                </button>
              </div>
              <!-- div to display messages received by this app. -->
              <div id="messages"></div>
            </div>
          </div>
          <div>
            <h4>Subscribe to one topic by pushing one button once</h4>
            <button
              id="sports"
              class="topic"
              value="sports"
              onclick="subscribe(event)"
            >
              sports
            </button>
            <button
              id="literature"
              class="topic"
              value="literature"
              onclick="subscribe(event)"
            >
              literature
            </button>
          </div>
        </div>
      </main>
      <div class="network-message">
        Network:
        <span id="network-status" class="">Good</span>
      </div>
    </div>

    <!-- Import and configure the Firebase SDK -->
    <!-- These scripts are made available when the app is served or deployed on Firebase Hosting -->
    <!-- If you do not serve/host your project using Firebase Hosting see https://firebase.google.com/docs/web/setup -->
    <script src="https://www.gstatic.com/firebasejs/9.6.0/firebase-app-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/9.6.0/firebase-messaging-compat.js"></script>

    <script>
      const firebaseConfig = {
        apiKey: "AIzaSyC1zJYEip3oRCKflBEzTYBM0P7oX5DiAkM",
        authDomain: "spamvictim.firebaseapp.com",
        databaseURL: "https://spamvictim.firebaseio.com",
        projectId: "spamvictim",
        storageBucket: "spamvictim.appspot.com",
        messagingSenderId: "486537133388",
        appId: "1:486537133388:web:21e39249b75df141c223e9",
        measurementId: "${config.measurementId}",
      };

      firebase.initializeApp(firebaseConfig);

      // Retrieve Firebase Messaging object.
      const messaging = firebase.messaging();

      // IDs of divs that display registration token UI or request permission UI.
      const tokenDivId = "token_div";
      const permissionDivId = "permission_div";

      // These registration tokens come from the client FCM SDKs.
      const registrationTokens = [];

      // Handle incoming messages. Called when:
      // - a message is received while the app has focus
      // - the user clicks on an app notification created by a service worker
      //   `messaging.onBackgroundMessage` handler.
      messaging.onMessage((payload) => {
        console.log("Message received. ", payload);
        // Update the UI to include the received message.
        appendMessage(payload);
      });

      function resetUI() {
        clearMessages();
        showToken("loading...");
        // Get registration token. Initially this makes a network call, once retrieved
        // subsequent calls to getToken will return from cache.
        messaging
          .getToken({
            vapidKey:
              "BOig49-Z0yU0CJ_Gaq4_A6G1wB6ezRmi6S88fjMJyghHmnXMEYM2yN2Bm4nfynajgTsQaZmLkzYrpbFCCF1GUIU",
          })
          .then((currentToken) => {
            if (currentToken) {
              sendTokenToServer(currentToken);
              updateUIForPushEnabled(currentToken);
            } else {
              // Show permission request.
              console.log(
                "No registration token available. Request permission to generate one."
              );
              // Show permission UI.
              updateUIForPushPermissionRequired();
              setTokenSentToServer(false);
            }
          })
          .catch((err) => {
            console.log("An error occurred while retrieving token. ", err);
            showToken("Error retrieving registration token. ", err);
            setTokenSentToServer(false);
          });
      }

      function subscribe(e) {
        console.log(e);
        topic = e.target.value;
        subscribeTokenToTopic(document.querySelector("#token").textContent, topic);
      }

      function showToken(currentToken) {
        // Show token in console and UI.
        const tokenElement = document.querySelector("#token");
        tokenElement.textContent = currentToken;
      }

      // Send the registration token your application server, so that it can:
      // - send messages back to this app
      // - subscribe/unsubscribe the token from topics
      function sendTokenToServer(currentToken) {
        if (!isTokenSentToServer()) {
          console.log("Sending token to server...");
          // TODO(developer): Send the current token to your server.
          setTokenSentToServer(true);
        } else {
          console.log(
            "Token already sent to server so won't send it again " +
              "unless it changes"
          );
        }
      }

      function isTokenSentToServer() {
        return window.localStorage.getItem("sentToServer") === "1";
      }

      function setTokenSentToServer(sent) {
        window.localStorage.setItem("sentToServer", sent ? "1" : "0");
      }

      function showHideDiv(divId, show) {
        const div = document.querySelector("#" + divId);
        if (show) {
          div.style = "display: visible";
        } else {
          div.style = "display: none";
        }
      }

      function requestPermission() {
        console.log("Requesting permission...");
        Notification.requestPermission().then((permission) => {
          if (permission === "granted") {
            console.log("Notification permission granted.");
            // TODO(developer): Retrieve a registration token for use with FCM.
            // In many cases once an app has been granted notification permission,
            // it should update its UI reflecting this.
            resetUI();
          } else {
            console.log("Unable to get permission to notify.");
          }
        });
      }

      function deleteToken() {
        // Delete registration token.
        messaging
          .getToken()
          .then((currentToken) => {
            messaging
              .deleteToken(currentToken)
              .then(() => {
                console.log("Token deleted.");
                setTokenSentToServer(false);
                // Once token is deleted update UI.
                resetUI();
              })
              .catch((err) => {
                console.log("Unable to delete token. ", err);
              });
          })
          .catch((err) => {
            console.log("Error retrieving registration token. ", err);
            showToken("Error retrieving registration token. ", err);
          });
      }

      // Add a message to the messages element.
      function appendMessage(payload) {
        const messagesElement = document.querySelector("#messages");
        const dataHeaderElement = document.createElement("h5");
        const dataElement = document.createElement("pre");
        dataElement.style = "overflow-x:hidden;";
        dataHeaderElement.textContent = "Received message:";
        dataElement.textContent = JSON.stringify(payload, null, 2);
        messagesElement.appendChild(dataHeaderElement);
        messagesElement.appendChild(dataElement);
      }

      // Clear the messages element of all children.
      function clearMessages() {
        const messagesElement = document.querySelector("#messages");
        while (messagesElement.hasChildNodes()) {
          messagesElement.removeChild(messagesElement.lastChild);
        }
      }

      function updateUIForPushEnabled(currentToken) {
        showHideDiv(tokenDivId, true);
        showHideDiv(permissionDivId, false);
        showToken(currentToken);
      }

      function updateUIForPushPermissionRequired() {
        showHideDiv(tokenDivId, false);
        showHideDiv(permissionDivId, true);
      }

      function subscribeTokenToTopic(token, topic) {
        fetch(
          "https://iid.googleapis.com/iid/v1/" + token + "/rel/topics/" + topic,
          {
            method: "POST",
            headers: new Headers({
              Authorization:
                "key=AAAAcUfffUw:APA91bEJqYfNiqZqr6--QFsl9v_zOi-nIVU_4UhsPKTY4irjagP7zkL8eGrbYXqBUqhHWOb0JReHZmaS5RpCgp7APbfpnExt9XcKospVrwtgxcdhK__Pm9B2IBREfzRkhiW9aUHq1174",
            }),
          }
        )
          .then((response) => {
            if (response.status < 200 || response.status >= 400) {
              throw (
                "Error subscribing to  the following topic: " +
                response.status +
                " - " +
                response.text()
              );
            } else {
              console.log('Successfully subscribed to "' + topic + '"');
            }
          })
          .catch((error) => {
            console.error(error);
          });
      }

      resetUI();
    </script>
    <!-- <script type="text/javascript">
      if (navigator.serviceWorker != null) {
        navigator.serviceWorker.register('/firebase-messaging-sw.js')
        .then(function(registration) {
          console.log('Registered events at scope: ', registration.scope);
        firebase.messaging().useServiceWorker(registration)
        });
      }

      if (!navigator.onLine) {
        statusEl.innerText = "Offline";
      }
    </script> -->
  </body>
</html>
